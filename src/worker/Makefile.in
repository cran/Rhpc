include ${MKCONF}
R_HOME = @R_HOME@
MPICC = @MPICC@
override        CC := @MPICC@
override        SHLIB_LD := @MPICC@
CP = cp
CHMOD = chmod
PKG_CFLAGS=-DR_PACKAGE_DIR='"@R_PACKAGE_DIR@"' -DR_HOME='"@R_HOME@"' @RCMDCONFIGCPPFLAGS@ @MPI_CFLAGS@
PKG_LIBS=@MPI_LDFLAGS@ @RCMDCONFIGLDFLAGS@
SOURCES_C=RhpcWorker.c RhpcWorkerSerialize.c
OBJECTS=$(SOURCES_C:.c=.o)


all:	RhpcWorker
	$(CHMOD) ugo+x Rhpc
	$(CHMOD) ugo+x RhpcSpawn
	$(CP) -p Rhpc       $(R_PACKAGE_DIR)
	$(CP) -p RhpcSpawn  $(R_PACKAGE_DIR)
	$(CP) -p RhpcWorker $(R_PACKAGE_DIR)

RhpcWorker: $(OBJECTS)
	$(CC) $(ALL_CPPFLAGS) $(ALL_CFLAGS) $(OBJECTS) -o $@ $(PKG_LIBS)

RhpcWorker.o: RhpcWorker.c
	$(CC) $(ALL_CPPFLAGS) $(ALL_CFLAGS) -c $< -o $@

RhpcSerialize.o: RhpcWorkerSerialize.c
	$(CC) $(ALL_CPPFLAGS) $(ALL_CFLAGS) -c $< -o $@

clean:
	@$(RM) -f RhpcWorker $(OBJECTS)
